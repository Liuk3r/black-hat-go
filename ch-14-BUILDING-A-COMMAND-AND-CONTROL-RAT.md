

## 开始

首先，让我们回顾一下将要做的事情：创建一个服务器，它以操作系统命令的形式从管理组件接收工作(也将创建管理组件)。 创建一个植入，定期轮询服务器获取新命令，然后将命令输出发布回服务器。 然后服务器将该结果返回给管理客户机，以便操作员(您)可以看到输出。 

首先安装工具，用于帮助我们处理这些网络交互，并检查这个项目的目录结构。

### 安装Protocol Buffers 用于定义 gRPC API

用 `gRPC` 构建所有的网络交互，`gRPC` 是有 Google 开发的一款高性能的远程过程调用 （RPC）框架。 RPC框架允许客户端通过标准和定义的协议与服务器通信，而无需知晓任何底层细节。 gRPC框架在HTTP/2上运行，以一种高效的二进制结构通信消息。

非常像其他的RPC机制，如 REST 或 SOAP，数据需要被定义，以便能够容易地序列化和反序列化。 幸运的是，有一种机制可以定义数据和API函数，因此可以与gRPC一起使用。 这个机制就是Protocol Buffers（也缩写为Protobuf），将API的标准语法和复杂的数据定义包含在 `.proto`文件中。 现有工具可将定义文件编译为Go支持的接口存根和数据类型。实际上，该工具可以生成各种语言的输出，也就是可以使用 `.proto` 文件生成 C# 存根和类型。

首先在系统中安装Protobuf编译器。 安装过程超出了本书的范围，但您可以在官方的 Go Protobuf库 https://github.com/golang/protobuf/ 上的“Installation”部分找到详细完整的安装信息。 同时，使用下面的命令安装gRPC包：

```sh
> go get -u google.golang.org/grpc
```

### 创建工程工作台

接下来，创建工程工作台。 创建四个子目录来存放三个组件（植入、服务器和管理组件）和定义 gRPC API 的文件。 每个组件的目录中，创建单个Go文件（与所在目录同名），该文件属于自己的 `main` 包。 这样可以作为独立的组件单独地编译和运行，且在组件上运行 `go build` 命令时会生成和目录同名的二进制。 同时，在 `grpcapi` 目录中创建名为 `implant.proto` 的文件。 该文件保存 Protobuf 架构和 gRPC API 定义。 目录结构应该像下面一样：

```sh
$ tree
.
|-- client
| |-- client.go
|-- grpcapi
| |-- implant.proto
|-- implant
| |-- implant.go
|-- server
| |-- server.go
```

创建了结构之后，我们就可以开始构建我们的实现了。在接下来的几个小节中，将带您浏览每个文件的内容。

